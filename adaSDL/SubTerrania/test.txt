===== FILE: ./config/subterrania_config.ads =====
--  Configuration for subterrania generated by Alire
pragma Restrictions (No_Elaboration_Code);
pragma Style_Checks (Off);

package Subterrania_Config is
   pragma Pure;

   Crate_Version : constant String := "0.1.0-dev";
   Crate_Name : constant String := "subterrania";

   Alire_Host_OS : constant String := "linux";

   Alire_Host_Arch : constant String := "x86_64";

   Alire_Host_Distro : constant String := "ubuntu";

   type Build_Profile_Kind is (release, validation, development);
   Build_Profile : constant Build_Profile_Kind := development;

end Subterrania_Config;


===== FILE: ./config/subterrania_config.h =====
/* Configuration for subterrania generated by Alire */
#ifndef SUBTERRANIA_CONFIG_H
#define SUBTERRANIA_CONFIG_H

#define CRATE_VERSION "0.1.0-dev"
#define CRATE_NAME "subterrania"

#define ALIRE_HOST_OS "linux"

#define ALIRE_HOST_ARCH "x86_64"

#define ALIRE_HOST_DISTRO "ubuntu"

#define BUILD_PROFILE_RELEASE 1
#define BUILD_PROFILE_VALIDATION 2
#define BUILD_PROFILE_DEVELOPMENT 3

#define BUILD_PROFILE  3

#endif


===== FILE: ./src/core/application.adb =====
with SDL;
with SDL.Video;
with SDL.Video.Windows.Makers;
with SDL.Video.Renderers.Makers;

with ECS.Components.Transform;
with ECS.Components.Velocity;
with ECS.Entity_System.Entity_Manager;
with ECS.Entity_System.Entity;
with Movement;

package body Application is

   package EM renames ECS.Entity_System.Entity_Manager;
   package Entity renames ECS.Entity_System.Entity;
   package Transform renames ECS.Components.Transform;
   package Velocity renames ECS.Components.Velocity;

   --  Window Setup
   Screen_Height : constant Natural := 800;
   Screen_Width  : constant Natural := 640;

   Window   : SDL.Video.Windows.Window;
   Renderer : SDL.Video.Renderers.Renderer;

   --------------------------------------------------
   --  INIT
   --------------------------------------------------

   procedure Init is
      T : access Transform.Transform;
      V : access Velocity.Velocity;
   begin
      if not SDL.Initialise (Flags => SDL.Enable_Screen) then
         Running := False;
         return;
      end if;

      SDL.Video.Windows.Makers.Create
        (Win      => Window,
         Title    => "ADA, ECS, SDL Test",
         Position => SDL.Natural_Coordinates'(X => 50, Y => 50),
         Size     =>
           SDL.Positive_Sizes'
           (SDL.Dimension (Screen_Width),
           SDL.Dimension (Screen_Height)),
         Flags    => 0);

      SDL.Video.Renderers.Makers.Create (Renderer, Window.Get_Surface);

      --  ECS Setup
      EM.Initialize (Mgr);

      Player := EM.Create_Entity (Mgr);

      EM.Add_Transform (Mgr, Player);
      EM.Add_Velocity  (Mgr, Player);

      T := EM.Get_Transform (Mgr, Player);
      V := EM.Get_Velocity  (Mgr, Player);

      T.X := 200.0;
      T.Y := 200.0;

      V.X := 2.0;
      V.Y := 1.0;
   end Init;

   --------------------------------------------------
   --  UPDATE
   --------------------------------------------------
   procedure Update is
      T : access Transform.Transform;
      V : access Velocity.Velocity;
   begin
      T := EM.Get_Transform (Mgr, Player);
      V := EM.Get_Velocity  (Mgr, Player);

      Movement.Move (T.Element, V.Element, 1.0);

      Window.Update_Surface;
   end Update;

   --------------------------------------------------
   --  RENDER
   --------------------------------------------------
   procedure Render is
      T : access Transform.Transform;
   begin
      Renderer.Fill
        (Rectangle =>
           (0,
            0,
            SDL.Natural_Dimension (Screen_Width),
            SDL.Natural_Dimension (Screen_Height)));
      T := EM.Get_Transform (Mgr, Player);

      Renderer.Set_Draw_Colour ((255, 0, 200, 255));

      Renderer.Fill
      (Rectangle =>
      (SDL.Natural_Dimension (Integer (T.X)),
      SDL.Natural_Dimension (Integer (T.Y)),
      40,
      40));
   end Render;

   procedure Shutdown is
   begin
      Window.Finalize;
      SDL.Finalise;
   end Shutdown;

   function Is_Running return Boolean is
   begin
      return Running;
   end Is_Running;

end Application;


===== FILE: ./src/core/application.ads =====
with ECS.Entity_System.Entity_Manager;
with ECS.Entity_System.Entity;

package Application is

   procedure Init;
   procedure Render;
   procedure Update;
   procedure Shutdown;

   function Is_Running return Boolean;

private

   --  package EM renames ECS.Entity_System.Entity_Manager;
   --  package Entity renames ECS.Entity_System.Entity;

   Mgr    : ECS.Entity_System.Entity_Manager.Entity_Manager_Type;
   Player : ECS.Entity_System.Entity.Entity_ID;

   Running : Boolean := True;

end Application;


===== FILE: ./src/core/subterrania.adb =====
--  with SDL;
--  with SDL.Events.Events;
with Application;

procedure SubTerrania is
begin
   Application.Init;

   while Application.Is_Running loop
      Application.Render;
      Application.Update;
   end loop;

   Application.Shutdown;
end SubTerrania;


===== FILE: ./src/ecs/components/ecs-components.ads =====
package ECS.Components is
end ECS.Components;


===== FILE: ./src/ecs/components/ecs-components-collider.ads =====
package ECS.Components.Collider is

   type Collider is record
      Width  : Float := 10.0;
      Height : Float := 10.0;
   end Collider;

end ECS.Components.Collider;


===== FILE: ./src/ecs/components/ecs-components-gravity.ads =====
package ECS.Components.Gravity is

   type Gravity is record
      Strength : Float := 1.0;
   end record;

end ECS.Components.Gravity;


===== FILE: ./src/ecs/components/ecs-components-renderable.ads =====
package ECS.Components.Renderable is

   type Renderable is record
      Width  : Float := 10.0;
      Height : Float := 10.0;
      Red    : Float := 128.0;
      Green  : Float := 15.0;
      Blue   : Float := 15.0;
   end record;

end ECS.Components.Renderable;


===== FILE: ./src/ecs/components/ecs-components-transform.ads =====
package ECS.Components.Transform is

   type Transform is record
      X        : Float := 0.0;
      Y        : Float := 0.0;
      Rotation : Float := 0.0;
   end record;

end ECS.Components.Transform;


===== FILE: ./src/ecs/components/ecs-components-velocity.ads =====
package ECS.Components.Velocity is

   type Velocity is record
      X : Float := 0.0;
      Y : Float := 0.0;
   end record;

end ECS.Components.Velocity;


===== FILE: ./src/ecs/ecs.ads =====
package ECS is
end ECS;


===== FILE: ./src/ecs/entity_system/ecs-entity_system.ads =====
package ECS.Entity_System is
end ECS.Entity_System;


===== FILE: ./src/ecs/entity_system/ecs-entity_system-entity.ads =====
package ECS.Entity_System.Entity is

   type Entity_ID is new Natural;

end ECS.Entity_System.Entity;


===== FILE: ./src/ecs/entity_system/ecs-entity_system-entity_manager.adb =====
package body ECS.Entity_System.Entity_Manager is

   function Hash
     (Key : Entity.Entity_ID)
      return Ada.Containers.Hash_Type is
   begin
      return Ada.Containers.Hash_Type (Key);
   end Hash;

   procedure Initialize (Mgr : in out Entity_Manager_Type) is
   begin
      null;
   end Initialize;

   function Create_Entity
     (Mgr : in out Entity_Manager_Type)
      return Entity.Entity_ID is
      ID : constant Entity.Entity_ID := Mgr.Next_ID;
   begin
      Mgr.Next_ID := Mgr.Next_ID + 1;
      return ID;
   end Create_Entity;

   procedure Add_Transform
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID) is
   begin
      Mgr.Transforms.Insert (E, Transform.Transform'(others => <>));
   end Add_Transform;

   procedure Add_Velocity
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID) is
   begin
      Mgr.Velocities.Insert (E, Velocity.Velocity'(others => <>));
   end Add_Velocity;

   function Get_Transform
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID)
      return Transform_Map.Reference_Type is
   begin
      return Mgr.Transforms.Reference (E);
   end Get_Transform;
   
   
   function Get_Velocity
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID)
      return Velocity_Map.Reference_Type is
   begin
      return Mgr.Velocities.Reference (E);
   end Get_Velocity;

end ECS.Entity_System.Entity_Manager;


===== FILE: ./src/ecs/entity_system/ecs-entity_system-entity_manager.ads =====
with Ada.Containers.Hashed_Maps;
with ECS.Entity_System.Entity;
with ECS.Components.Transform;
with ECS.Components.Velocity;

use type ECS.Entity_System.Entity.Entity_ID;
use type ECS.Components.Transform.Transform;
use type ECS.Components.Velocity.Velocity;

package ECS.Entity_System.Entity_Manager is

   package Entity    renames ECS.Entity_System.Entity;
   package Transform renames ECS.Components.Transform;
   package Velocity  renames ECS.Components.Velocity;

   type Entity_Manager_Type is tagged private;

   procedure Initialize (Mgr : in out Entity_Manager_Type);

   function Create_Entity
     (Mgr : in out Entity_Manager_Type)
      return Entity.Entity_ID;

   procedure Add_Transform
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID);

   procedure Add_Velocity
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID);

   function Get_Transform
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID)
      return Transform_Map.Reference_Type;

   function Get_Velocity
     (Mgr : in out Entity_Manager_Type;
      E   : Entity.Entity_ID)
      return Velocity_Map.Reference_Type;

private

   function Hash
     (Key : Entity.Entity_ID)
      return Ada.Containers.Hash_Type;

   package Transform_Map is new Ada.Containers.Hashed_Maps
     (Key_Type        => Entity.Entity_ID,
      Element_Type    => Transform.Transform,
      Hash            => Hash,
      Equivalent_Keys => "=");

   package Velocity_Map is new Ada.Containers.Hashed_Maps
     (Key_Type        => Entity.Entity_ID,
      Element_Type    => Velocity.Velocity,
      Hash            => Hash,
      Equivalent_Keys => "=");

   type Entity_Manager_Type is tagged record
      Next_ID    : Entity.Entity_ID := 1;
      Transforms : Transform_Map.Map;
      Velocities : Velocity_Map.Map;
   end record;

end ECS.Entity_System.Entity_Manager;


===== FILE: ./src/ecs/systems/collision.adb =====
 


===== FILE: ./src/ecs/systems/collision.ads =====
 


===== FILE: ./src/ecs/systems/inputs.adb =====
with SDL;
with SDL.Events;
use SDL.Events;
with SDL.Events.Events;

with SDL.Events.Keyboards;
use SDL.Events.Keyboards;

with Ada.Text_IO; use Ada.Text_IO;
with Application;
with ECS.Components.Velocity;

package body Inputs is

   Event : SDL.Events.Events.Events;

   procedure PollEvents
      (V : in out ECS.Components.Velocity.Velocity) is
   begin
      while SDL.Events.Events.Poll (Event) loop
         --  Quit event
         if Event.Common.Event_Type = SDL.Events.Quit then
            Application.Running := False;
         end if;

         --  Key Down
         if Event.Common.Event_Type = SDL.Events.Keyboards.Key_Down then
            case Event.Keyboard.Key_Sym.Key_Code is
               when Code_W => Put_Line ("W Pressed"); V.X := 1.0;
               when Code_A => Put_Line ("A Pressed"); V.Y := -1.0;
               when Code_S => Put_Line ("S Pressed"); V.X := -1.0;
               when Code_D => Put_Line ("D Pressed"); V.X := 1.0;
               when others => null; V.X := 0.0; V.Y := 0.0;
            end case;
         end if;

      end loop;
   end PollEvents;

end Inputs;


===== FILE: ./src/ecs/systems/inputs.ads =====
with ECS.Components.Velocity;

package Inputs is
   procedure PollEvents
      (V : in out ECS.Components.Velocity.Velocity);
end Inputs;


===== FILE: ./src/ecs/systems/movement.adb =====
--  with Ada.Text_IO; use Ada.Text_IO;
with ECS.Components.Transform;
with ECS.Components.Velocity;

package body Movement is

   procedure Move
      (T : in out ECS.Components.Transform.Transform;
      V : in ECS.Components.Velocity.Velocity;
      DT : Float) is
   begin
      T.X := T.X + V.X * DT;
      T.Y := T.Y + V.Y * DT;
      --  Put_Line ("T.X: " & Float'Image
      --  (T.X) & " T.Y: " & Float'Image (T.Y));
   end Move;

end Movement;


===== FILE: ./src/ecs/systems/movement.ads =====
with ECS.Components.Transform;
with ECS.Components.Velocity;

package Movement is
   procedure Move
      (T : in out ECS.Components.Transform.Transform;
      V : in ECS.Components.Velocity.Velocity;
      DT : Float);
end Movement;


===== FILE: ./src/ecs/systems/render.adb =====
 


===== FILE: ./src/ecs/systems/render.ads =====
 


